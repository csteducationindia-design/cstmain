<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Portal - CST Institute</title>
    
    <link rel="manifest" href="/static/manifest.json">

    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;600;700;900" onload="this.rel='stylesheet'" rel="stylesheet"/>
    
    <script src="{{ url_for('static', filename='tailwind.js') }}"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1173d4",
                        "primary-hover": "#0e5ea8",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "surface-light": "#ffffff",
                        "surface-dark": "#1e293b",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                },
            },
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    
    <style>
        /* Custom Scrollbar for Sidebar */
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
        .dark .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: #475569;
        }
        
        /* Animation Utilities */
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Table Responsive Helpers */
        .table-container {
            overflow-x: auto;
            width: 100%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-800 dark:text-slate-200 antialiased h-screen overflow-hidden flex">

    <aside class="w-64 bg-surface-light dark:bg-surface-dark border-r border-slate-200 dark:border-slate-800 flex flex-col shadow-xl z-20 transition-all duration-300">
        
        <div class="p-6 border-b border-slate-100 dark:border-slate-700">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-blue-500/30">
                    T
                </div>
                <div>
                    <h1 class="text-lg font-bold text-slate-900 dark:text-white leading-tight">Teacher Portal</h1>
                    <p class="text-xs text-slate-500 dark:text-slate-400 font-medium">CST Institute</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto scrollbar-thin">
            
            <a href="#dashboard" class="nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-primary/5 dark:hover:bg-primary/10">
                <span class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors">dashboard</span>
                <span class="text-sm font-medium text-slate-600 dark:text-slate-300 group-hover:text-primary dark:group-hover:text-primary-400">Dashboard</span>
            </a>
            <a href="#announcements" class="nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-primary/5 dark:hover:bg-primary/10">
    <span class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors">campaign</span>
    <span class="text-sm font-medium text-slate-600 dark:text-slate-300 group-hover:text-primary">Announcements</span>
</a>
            <a href="#courses" class="nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-primary/5 dark:hover:bg-primary/10">
                <span class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors">book</span>
                <span class="text-sm font-medium text-slate-600 dark:text-slate-300 group-hover:text-primary dark:group-hover:text-primary-400">My Courses</span>
            </a>
            
            <div class="pt-4 pb-1 pl-4 text-xs font-bold text-slate-400 uppercase tracking-wider">Academics</div>

            <a href="#attendance" class="nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-primary/5 dark:hover:bg-primary/10">
                <span class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors">fact_check</span>
                <span class="text-sm font-medium text-slate-600 dark:text-slate-300 group-hover:text-primary dark:group-hover:text-primary-400">Mark Attendance</span>
            </a>

            <a href="#syllabus" class="nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-primary/5 dark:hover:bg-primary/10">
                <span class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors">menu_book</span>
                <span class="text-sm font-medium text-slate-600 dark:text-slate-300 group-hover:text-primary dark:group-hover:text-primary-400">Syllabus Tracker</span>
            </a>

            <a href="#assignments" class="nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-primary/5 dark:hover:bg-primary/10">
                <span class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors">assignment</span>
                <span class="text-sm font-medium text-slate-600 dark:text-slate-300 group-hover:text-primary dark:group-hover:text-primary-400">Assignments</span>
            </a>
            
            <div class="pt-4 pb-1 pl-4 text-xs font-bold text-slate-400 uppercase tracking-wider">Resources & Reports</div>

            <a href="#notes" class="nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-primary/5 dark:hover:bg-primary/10">
                <span class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors">upload_file</span>
                <span class="text-sm font-medium text-slate-600 dark:text-slate-300 group-hover:text-primary dark:group-hover:text-primary-400">Share Notes</span>
            </a>
            
            <a href="#reports" class="nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-primary/5 dark:hover:bg-primary/10">
                <span class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors">analytics</span>
                <span class="text-sm font-medium text-slate-600 dark:text-slate-300 group-hover:text-primary dark:group-hover:text-primary-400">Student Reports</span>
            </a>

            <button id="install-app-btn" class="hidden w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-green-50 text-green-700 hover:bg-green-100 transition-colors mt-6 border border-green-200 shadow-sm">
                <span class="material-symbols-outlined">download</span>
                <span class="text-sm font-bold">Install App</span>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50">
            <button id="logout-btn" class="flex items-center justify-center gap-2 w-full bg-red-50 text-red-600 hover:bg-red-100 font-bold py-3 px-4 rounded-xl text-sm transition duration-150 border border-red-100">
                <span class="material-symbols-outlined text-lg">logout</span>
                Logout
            </button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto bg-background-light dark:bg-background-dark p-6 md:p-8 lg:p-10 relative">
        <div class="max-w-7xl mx-auto space-y-8 pb-20">
            
            <header class="flex justify-between items-end border-b border-slate-200 dark:border-slate-700 pb-6">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900 dark:text-white tracking-tight" id="page-title">Dashboard</h1>
                    <p class="text-slate-500 dark:text-slate-400 mt-2 text-sm font-medium" id="welcome-message">Welcome back, Teacher.</p>
                </div>
                <div class="hidden md:flex flex-col items-end">
                    <span class="px-4 py-1.5 bg-blue-100 text-blue-700 text-xs font-bold uppercase tracking-wider rounded-full dark:bg-blue-900 dark:text-blue-200 mb-2">
                        Instructor Account
                    </span>
                    <p class="text-xs text-slate-400" id="current-date-display">...</p>
                </div>
            </header>

            <div id="content-dashboard" class="content-section animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm p-6 border border-slate-100 dark:border-slate-700 relative overflow-hidden group hover:shadow-md transition-shadow">
                        <div class="absolute right-0 top-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                        <div class="flex items-center gap-4 relative z-10">
                            <div class="p-4 bg-blue-100 text-blue-600 rounded-2xl dark:bg-blue-900/30 dark:text-blue-400 shadow-sm">
                                <span class="material-symbols-outlined text-3xl">book</span>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wide">My Courses</p>
                                <p class="text-3xl font-bold text-slate-900 dark:text-white mt-1" id="total-my-courses">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm p-6 border border-slate-100 dark:border-slate-700 relative overflow-hidden group hover:shadow-md transition-shadow">
                        <div class="absolute right-0 top-0 w-24 h-24 bg-emerald-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                        <div class="flex items-center gap-4 relative z-10">
                            <div class="p-4 bg-emerald-100 text-emerald-600 rounded-2xl dark:bg-emerald-900/30 dark:text-emerald-400 shadow-sm">
                                <span class="material-symbols-outlined text-3xl">groups</span>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wide">Total Students</p>
                                <p class="text-3xl font-bold text-slate-900 dark:text-white mt-1" id="total-my-students">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm p-6 border border-slate-100 dark:border-slate-700 relative overflow-hidden group hover:shadow-md transition-shadow">
                        <div class="absolute right-0 top-0 w-24 h-24 bg-purple-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                        <div class="flex items-center gap-4 relative z-10">
                            <div class="p-4 bg-purple-100 text-purple-600 rounded-2xl dark:bg-purple-900/30 dark:text-purple-400 shadow-sm">
                                <span class="material-symbols-outlined text-3xl">description</span>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wide">Shared Notes</p>
                                <p class="text-3xl font-bold text-slate-900 dark:text-white mt-1" id="total-shared-notes">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                        <h3 class="font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">calendar_month</span>
                            My Weekly Timetable
                        </h3>
                        <span class="text-xs text-slate-400 uppercase font-bold tracking-wider">Schedule</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                            <thead class="bg-slate-50 dark:bg-slate-800">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Day</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">10:00 AM - 12:00 PM</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">02:00 PM - 04:00 PM</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Lab Session</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-surface-dark divide-y divide-slate-200 dark:divide-slate-700 text-sm">
                                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition"><td class="px-6 py-4 font-bold text-slate-700 dark:text-slate-300">Monday</td><td class="px-6 py-4"><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold">Java Programming</span></td><td class="px-6 py-4"><span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-bold">C++ Basics</span></td><td class="px-6 py-4 text-slate-400">-</td></tr>
                                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition"><td class="px-6 py-4 font-bold text-slate-700 dark:text-slate-300">Tuesday</td><td class="px-6 py-4"><span class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs font-bold">Python Advanced</span></td><td class="px-6 py-4"><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold">Java Programming</span></td><td class="px-6 py-4 text-slate-400">-</td></tr>
                                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition"><td class="px-6 py-4 font-bold text-slate-700 dark:text-slate-300">Wednesday</td><td class="px-6 py-4"><span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-bold">C++ Basics</span></td><td class="px-6 py-4"><span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-bold">Tally Prime</span></td><td class="px-6 py-4 text-slate-400">-</td></tr>
                                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition"><td class="px-6 py-4 font-bold text-slate-700 dark:text-slate-300">Thursday</td><td class="px-6 py-4"><span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-bold">Tally Prime</span></td><td class="px-6 py-4"><span class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs font-bold">Python Advanced</span></td><td class="px-6 py-4 text-slate-400">-</td></tr>
                                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition"><td class="px-6 py-4 font-bold text-slate-700 dark:text-slate-300">Friday</td><td class="px-6 py-4 text-slate-400">Free</td><td class="px-6 py-4 text-slate-400">Free</td><td class="px-6 py-4"><span class="px-2 py-1 bg-slate-100 text-slate-700 rounded text-xs font-bold">Practical Lab</span></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="content-courses" class="content-section hidden animate-fade-in">
                <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
                        <h2 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">library_books</span>
                            Assigned Subjects
                        </h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                            <thead class="bg-slate-50 dark:bg-slate-800">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Course Name</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Subjects / Topics Included</th>
                                    <th class="px-6 py-4 text-right text-xs font-bold text-slate-500 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody id="teacher-courses-body" class="divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-surface-dark">
                                <tr><td colspan="3" class="px-6 py-12 text-center text-slate-500">Loading courses...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

<div id="content-attendance" class="content-section hidden animate-fade-in">
                <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-md p-8 border border-slate-100 dark:border-slate-700 mb-8 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-primary"></div>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-6">Step 1: Select Class & Date</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">1. Select Batch</label>
                            <select id="att-session" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary p-2.5 shadow-sm" onchange="loadStudents()">
                                <option value="">All Batches</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">2. Select Course</label>
                            <select id="att-course" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary p-2.5 shadow-sm" onchange="loadStudents()">
                                <option value="">-- Choose Course --</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">3. Date</label>
                            <input type="date" id="att-date" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white p-2.5 shadow-sm">
                        </div>
                    </div>
                </div>

                <form id="att-form">
                    <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm overflow-hidden border border-slate-100 dark:border-slate-700 mb-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                                <thead class="bg-slate-50 dark:bg-slate-800">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Photo</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Student Name</th>
                                        <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase tracking-wider">Mark Status</th>
                                    </tr>
                                </thead>
                                <tbody id="att-body" class="divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-surface-dark">
                                    <tr><td colspan="3" class="px-6 py-16 text-center text-slate-400">Select a Course to load students.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="flex justify-end pb-8">
                        <button type="submit" class="bg-green-600 text-white font-bold py-3.5 px-10 rounded-xl shadow-lg hover:bg-green-700 transition flex items-center gap-2">
                            <span class="material-symbols-outlined">save</span> Submit Attendance
                        </button>
                    </div>
                </form>
            </div>

            <div id="content-syllabus" class="content-section hidden animate-fade-in">
                <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm p-8 border border-slate-100 dark:border-slate-700 max-w-4xl mx-auto">
                    <div class="flex items-center gap-3 mb-6 pb-6 border-b border-slate-100 dark:border-slate-700">
                        <div class="p-3 bg-indigo-50 text-indigo-600 rounded-xl"><span class="material-symbols-outlined">menu_book</span></div>
                        <div>
                            <h3 class="text-xl font-bold text-slate-900 dark:text-white">Daily Syllabus Log</h3>
                            <p class="text-sm text-slate-500">Record what was taught in class today.</p>
                        </div>
                    </div>
                    
                    <form class="space-y-6" onsubmit="event.preventDefault(); alert('Syllabus log saved (Mock)!');">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Course</label>
                                <select id="syllabus-course-select" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-sm p-3 focus:ring-primary">
                                    <option value="">-- Choose Course --</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Date</label>
                                <input type="date" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-sm p-3 focus:ring-primary">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Topics Covered Today</label>
                            <textarea rows="4" placeholder="e.g. Introduction to Loops, While Loop syntax, Practice problems..." class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-sm p-3 focus:ring-primary"></textarea>
                        </div>
                        <div class="flex justify-end">
                            <button class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-indigo-700 shadow-md transition flex items-center gap-2">
                                <span class="material-symbols-outlined text-sm">save_as</span>
                                Save Syllabus Log
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="content-assignments" class="content-section hidden animate-fade-in">
                <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm p-6 border border-slate-100 dark:border-slate-700 mb-6">
                    <div class="flex items-end gap-4">
                        <div class="w-full md:w-1/2">
                            <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Select Course to View Students</label>
                            <select id="assignment-course-select" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm p-3 focus:ring-primary">
                                <option value="">-- Choose Course --</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm overflow-hidden border border-slate-100 dark:border-slate-700">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                            <thead class="bg-slate-50 dark:bg-slate-800">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Student Name</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Assignment Status</th>
                                    <th class="px-6 py-4 text-right text-xs font-bold text-slate-500 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody id="assignment-table-body" class="divide-y divide-slate-200 dark:divide-slate-700">
                                <tr><td colspan="3" class="px-6 py-12 text-center text-slate-500">Please select a course to track assignments.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
<div id="content-announcements" class="content-section hidden animate-fade-in">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-1">
            <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm p-6 border border-slate-100 dark:border-slate-700">
                <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">campaign</span>
                    Post Announcement
                </h3>
                <form id="teacher-announcement-form" class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Category</label>
                        <select id="ann-category" required class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 p-3">
                            <option>Holiday</option>
                            <option>Assignment Test</option>
                            <option>Practical Test</option>
                            <option>Certificate Collection</option>
                            <option>Python Class Start</option>
                            <option>Java Class Start</option>
                            <option>Batch Time Update</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Title</label>
                        <input type="text" id="ann-title" required class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 p-3">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Message Content</label>
                        <textarea id="ann-content" rows="4" required class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 p-3"></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Target Audience</label>
                        <select id="ann-target" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 p-3">
                            <option value="students">Students Only</option>
                            <option value="parents">Parents Only</option>
                            <option value="all">Everyone</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 rounded-xl font-bold hover:bg-primary-hover shadow-lg transition">Broadcast Notification</button>
                </form>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                <div class="p-6 border-b border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold">My Sent Notifications</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                        <tbody id="announcement-history-body" class="divide-y divide-slate-200 dark:divide-slate-700">
                            <tr><td class="p-6 text-center text-slate-500">Loading history...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
            <div id="content-notes" class="content-section hidden animate-fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1">
                        <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm p-6 border border-slate-100 dark:border-slate-700 sticky top-4">
                            <div class="flex items-center gap-2 mb-6">
                                <span class="material-symbols-outlined text-primary">cloud_upload</span>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white">Upload Material</h3>
                            </div>
                            
                            <form id="upload-note-form" class="space-y-5">
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Title</label>
                                    <input type="text" name="title" required class="w-full rounded-lg border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-sm focus:ring-primary p-2.5" placeholder="e.g. Chapter 1 Notes">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Course</label>
                                    <select id="note-course-select" name="course_id" required class="w-full rounded-lg border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-sm focus:ring-primary p-2.5"></select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Description</label>
                                    <textarea name="description" rows="3" class="w-full rounded-lg border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-sm focus:ring-primary p-2.5" placeholder="Short description..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">File Attachment</label>
                                    <input type="file" id="note-file" name="file" required accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.jpg,.png" class="w-full text-sm text-slate-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 transition cursor-pointer">
                                    <p class="text-xs text-slate-400 mt-2">Supported: PDF, DOC, PPT, IMG (Max 16MB)</p>
                                </div>
                                <button type="submit" id="upload-note-btn" class="w-full bg-primary text-white font-bold py-3 rounded-xl hover:bg-primary-hover transition shadow-md flex justify-center items-center gap-2">
                                    <span class="material-symbols-outlined text-sm">publish</span>
                                    Upload & Notify Students
                                </button>
                            </form>
                            <div id="upload-progress" class="hidden mt-6">
                                <div class="w-full bg-slate-200 rounded-full h-2"><div id="upload-bar" class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div></div>
                                <p id="upload-status" class="text-xs text-center mt-2 text-slate-500 font-medium">Uploading...</p>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-2">
                        <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                            <div class="p-6 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50">
                                <h3 class="font-bold text-slate-900 dark:text-white">My Uploaded Notes History</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                                    <thead class="bg-slate-50 dark:bg-slate-800">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Title</th>
                                            <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Course</th>
                                            <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-4 text-right text-xs font-bold text-slate-500 uppercase tracking-wider">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teacher-notes-body" class="divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-surface-dark">
                                        <tr><td colspan="4" class="px-6 py-12 text-center text-slate-500">No notes uploaded yet.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="content-reports" class="content-section hidden animate-fade-in">
                <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm p-6 mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4 border border-slate-100 dark:border-slate-700">
                    <div>
                        <h2 class="text-xl font-bold text-slate-900 dark:text-white">Student Reports</h2>
                        <p class="text-sm text-slate-500 mt-1">View comprehensive student data by course.</p>
                    </div>
                    <div class="w-full md:w-72">
                        <label for="report-course-select" class="block text-xs font-bold uppercase text-slate-400 mb-1">Filter by Course</label>
                        <select id="report-course-select" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm p-2.5 focus:ring-primary">
                            <option value="">Show All Students</option>
                        </select>
                    </div>
                </div>

                <div class="bg-white dark:bg-surface-dark rounded-2xl shadow-sm overflow-hidden border border-slate-100 dark:border-slate-700">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                            <thead class="bg-slate-50 dark:bg-slate-800">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Photo</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase tracking-wider">Attendance</th>
                                    <th class="px-6 py-4 text-right text-xs font-bold text-slate-500 uppercase tracking-wider">Quick Remarks & Message</th>
                                </tr>
                            </thead>
                            <tbody id="teacher-reports-body" class="divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-surface-dark">
                                <tr><td colspan="4" class="px-6 py-12 text-center text-slate-500">Loading reports data...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>
</div>

<div id="notify-modal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity backdrop-blur-sm" id="modal-backdrop"></div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white dark:bg-surface-dark rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full border border-slate-200 dark:border-slate-700">
            <div class="px-6 py-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="p-2 bg-blue-50 text-blue-600 rounded-lg"><span class="material-symbols-outlined">send</span></div>
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white" id="notify-modal-title">Send Message</h3>
                </div>
                
                <form class="space-y-4">
                    <input type="hidden" id="notify-student-id">
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Subject</label>
                        <input type="text" id="notify-subject" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm focus:ring-primary p-3" placeholder="Important Update...">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Message Body</label>
                        <textarea id="notify-body" rows="4" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm focus:ring-primary p-3" placeholder="Type your message here..."></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Communication Channel</label>
                        <select id="notify-type" class="w-full rounded-xl border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm focus:ring-primary p-3">
                            <option value="portal">ðŸ“± App Notification (Push)</option>
                            <option value="sms">ðŸ’¬ SMS</option>
                            <option value="whatsapp">ðŸ’š WhatsApp</option>
                            <option value="email">ðŸ“§ Email</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="bg-slate-50 dark:bg-slate-800/50 px-6 py-4 flex flex-row-reverse gap-3 border-t border-slate-100 dark:border-slate-700">
                <button type="button" id="send-notify-btn" class="w-full sm:w-auto px-6 py-2.5 bg-primary text-white rounded-xl font-bold hover:bg-primary-hover shadow-md transition transform active:scale-95 flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined text-sm">send</span> Send Message
                </button>
                <button type="button" id="cancel-notify-btn" class="w-full sm:w-auto px-6 py-2.5 bg-white border border-slate-300 text-slate-700 rounded-xl font-bold hover:bg-slate-50 transition transform active:scale-95">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

<script>
    // --- 1. CONFIGURATION ---
    const API_ORIGIN = window.location.origin;
    const API_BASE_URL = API_ORIGIN + '/api'; // Unified Variable Name
    
    let sessions = [], courses = [];
    let html5QrCode;

    // --- 2. NAVIGATION ---
    function showSection(id) {
        document.querySelectorAll('.content-section').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.tab-link').forEach(el => {
            el.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
            el.classList.add('text-gray-500');
        });
        
        const target = document.getElementById('content-'+id);
        if(target) target.classList.remove('hidden');
        
        const activeBtn = document.querySelector(`button[onclick="showSection('${id}')"]`);
        if(activeBtn) {
            activeBtn.classList.remove('text-gray-500');
            activeBtn.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        }
    }

    // --- 3. INITIALIZATION (DATA LOADING) ---
    async function init() {
        // Set Default Dates
        const today = new Date().toISOString().split('T')[0];
        if(document.getElementById('att-date')) document.getElementById('att-date').value = today;
        if(document.getElementById('report-date')) document.getElementById('report-date').value = today;
        
        try {
            // A. Check Login Session
            const sessionRes = await fetch(`${API_BASE_URL}/check_session`, {credentials: 'include'});
            const sessionData = await sessionRes.json();
            
            if(!sessionData.logged_in || sessionData.user.role !== 'teacher') {
                console.warn("Not logged in as teacher. Redirecting...");
                window.location.href = '/'; 
                return;
            }

            // B. Fetch Data (Sessions & Courses)
            const [sRes, cRes] = await Promise.all([
                fetch(`${API_BASE_URL}/teacher/sessions`, {credentials: 'include'}),
                fetch(`${API_BASE_URL}/teacher/courses`, {credentials: 'include'})
            ]);

            sessions = await sRes.json();
            courses = await cRes.json();

            // DEBUG: Check if data arrived
            console.log("Loaded Sessions:", sessions);
            console.log("Loaded Courses:", courses);

            if (courses.length === 0) {
                console.warn("No courses found for this teacher.");
                // Optional: Alert the user
                // alert("Warning: No courses are assigned to this account.");
            }

            // C. Populate Dropdowns
            const fill = (id, list, defaultText) => {
                const el = document.getElementById(id);
                if(el) {
                    el.innerHTML = `<option value="">${defaultText}</option>` + 
                        list.map(i => `<option value="${i.id}">${i.name}</option>`).join('');
                }
            };
            
            // Attendance Tab
            fill('att-session', sessions, "All Batches");
            fill('att-course', courses, "-- Select Course --");
            
            // Reports & Other Tabs
            fill('report-session', sessions, "All Batches");
            fill('report-course', courses, "-- Select Course --");
            fill('note-course-select', courses, "-- Select Course --");
            fill('syllabus-course-select', courses, "-- Select Course --");
            fill('assignment-course-select', courses, "-- Select Course --");

            // D. Dashboard Stats
            if(document.getElementById('total-my-courses')) {
                document.getElementById('total-my-courses').textContent = courses.length;
            }
            
            // E. Init Firebase
            initFirebase();

        } catch(e) { 
            console.error("Init Error:", e);
            alert("Error loading data. Please reload the page.");
        }
    }

    // --- 4. ATTENDANCE LOGIC ---
async function loadStudents() {
        const sid = document.getElementById('att-session').value;
        const cid = document.getElementById('att-course').value;
        const tbody = document.getElementById('att-body');
        
        // Only Course is required to start loading
        if(!cid) {
            tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-12 text-center text-slate-400">Please select a Course first.</td></tr>';
            return;
        } 

        tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-12 text-center text-slate-500">Loading students...</td></tr>';

        try {
            // FIX: Build URL safely
            const url = new URL(`${API_BASE_URL}/teacher/students`);
            url.searchParams.append('course_id', cid);
            // Only append session_id if it has a real value
            if(sid) url.searchParams.append('session_id', sid);

            const res = await fetch(url, { credentials: 'include' });
            const students = await res.json();
            
            if (students.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="3" class="px-6 py-12 text-center text-red-500">
                            <div class="font-bold">No students found.</div>
                            <div class="text-xs mt-1 text-gray-500">Tip: Ensure students are enrolled in this Course in the Admin Panel.</div>
                        </td>
                    </tr>`;
                return;
            }

            tbody.innerHTML = students.map(s => `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-800 transition border-b border-slate-100 dark:border-slate-800">
                    <td class="px-6 py-4">
                        <img src="${s.profile_photo_url || 'https://placehold.co/50'}" class="w-12 h-12 rounded-full border-2 border-white shadow-sm object-cover">
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-bold text-slate-900 dark:text-white">${s.name}</div>
                        <div class="text-xs text-slate-500">ID: ${s.admission_number || '-'}</div>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <div class="flex justify-center gap-4">
                            <label class="cursor-pointer flex items-center gap-2 bg-green-50 px-4 py-2 rounded-xl border border-green-200 hover:bg-green-100 transition">
                                <input type="radio" name="att-${s.id}" value="Present" checked class="w-4 h-4 text-green-600"> 
                                <span class="text-green-800 font-bold text-sm">Present</span>
                            </label>
                            <label class="cursor-pointer flex items-center gap-2 bg-red-50 px-4 py-2 rounded-xl border border-red-200 hover:bg-red-100 transition">
                                <input type="radio" name="att-${s.id}" value="Absent" class="w-4 h-4 text-red-600"> 
                                <span class="text-red-800 font-bold text-sm">Absent</span>
                            </label>
                        </div>
                    </td>
                </tr>
            `).join('');
        } catch (e) {
            console.error("Load Error:", e);
            tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-12 text-center text-red-500">System Error. Check Console.</td></tr>';
        }
    }

    document.getElementById('att-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const rows = document.getElementById('att-body').querySelectorAll('tr');
        if (rows.length === 0 || rows[0].innerText.includes("No students")) return alert("No students loaded.");

        const data = [];
        rows.forEach(r => {
            const input = r.querySelector('input[type="radio"]:checked');
            if(input) {
                const id = input.name.split('-')[1];
                data.push({ student_id: parseInt(id), status: input.value });
            }
        });

        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.innerHTML;
        btn.innerHTML = 'Saving...';
        btn.disabled = true;

        try {
            await fetch(`${API_BASE_URL}/teacher/attendance`, {
                method:'POST', 
                headers:{'Content-Type':'application/json'},
                credentials: 'include',
                body: JSON.stringify({ 
                    date: document.getElementById('att-date').value, 
                    attendance_data: data 
                })
            });
            alert('Attendance Saved! Notifications sent.');
        } catch(err) {
            alert('Error saving attendance. Check console.');
            console.error(err);
        } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    });

    // --- 5. QR SCANNER LOGIC ---
    function startScanner() {
        const modal = document.getElementById('qr-modal');
        if(modal) modal.classList.remove('hidden');
        
        html5QrCode = new Html5Qrcode("reader");
        html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (decodedText) => {
            // Find student by ID (assuming QR contains ID or Admission No)
            // Logic: Look for radio button with name="att-{ID}"
            // Note: This requires the student list to be loaded FIRST.
            
            // Try matching ID directly
            let radio = document.querySelector(`input[name="att-${decodedText}"][value="Present"]`);
            
            if (!radio) {
                // If not found by ID, try finding by text in the table (Admission Number)
                const rows = document.querySelectorAll('#att-body tr');
                rows.forEach(row => {
                    if(row.innerText.includes(decodedText)) {
                        radio = row.querySelector('input[value="Present"]');
                    }
                });
            }

            if (radio) {
                radio.checked = true;
                alert("Marked Present: " + decodedText);
                stopScanner();
            } else {
                alert("Student " + decodedText + " not found in the current list. \nPlease select the correct Batch/Course first.");
                stopScanner();
            }
        }).catch(err => {
            console.log("Scanner Error", err);
            alert("Camera error: " + err);
            stopScanner();
        });
    }

    function stopScanner() {
        if(html5QrCode) {
            html5QrCode.stop().then(() => {
                const modal = document.getElementById('qr-modal');
                if(modal) modal.classList.add('hidden');
                html5QrCode.clear();
            });
        } else {
            const modal = document.getElementById('qr-modal');
            if(modal) modal.classList.add('hidden');
        }
    }

    // --- 6. REPORTS LOGIC ---
    async function loadReport() {
        const sid = document.getElementById('report-session').value;
        const cid = document.getElementById('report-course').value;
        const date = document.getElementById('report-date').value;
        
        if(!cid) return;

        const tbody = document.getElementById('report-body');
        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-slate-500">Loading report...</td></tr>';

        try {
            let url = `${API_BASE_URL}/teacher/reports/attendance?course_id=${cid}&date=${date}`;
            if(sid) url += `&session_id=${sid}`;

            const res = await fetch(url, { credentials: 'include' });
            const data = await res.json();
            
            if(data.length === 0) { 
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-slate-400">No records found.</td></tr>'; 
                return; 
            }

            tbody.innerHTML = data.map(r => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-3"><img src="${r.photo_url || 'https://placehold.co/50'}" class="w-10 h-10 rounded-full border object-cover"></td>
                    <td class="p-3">
                        <div class="font-bold text-gray-800">${r.student_name}</div>
                        <div class="text-xs text-gray-500">ID: ${r.admission_number}</div>
                    </td>
                    <td class="p-3 text-center">
                        <div class="flex flex-col items-center">
                            <span class="text-xs font-bold text-slate-700 mb-1">${r.present} / ${r.total_classes}</span>
                            <div class="w-16 h-1.5 bg-gray-200 rounded-full overflow-hidden">
                                <div class="${(r.present/r.total_classes) < 0.75 ? 'bg-red-500' : 'bg-green-500'} h-full" style="width: ${(r.present/r.total_classes)*100 || 0}%"></div>
                            </div>
                        </div>
                    </td>
                    <td class="p-3 text-center">
                        <span class="px-2 py-1 rounded text-xs font-bold ${r.status==='Present'?'bg-green-100 text-green-800':r.status==='Absent'?'bg-red-100 text-red-800':'bg-gray-100 text-gray-500'}">
                            ${r.status}
                        </span>
                    </td>
                </tr>
            `).join('');
        } catch(e) { console.error(e); }
    }

    // --- 7. UTILS & FIREBASE ---
    document.getElementById('logout-btn').onclick = async()=>{ 
        await fetch(`${API_BASE_URL}/logout`, {method:'POST'}); 
        window.location.href='/'; 
    };

    function initFirebase() {
        try {
            const firebaseConfig = {
                apiKey: "AIzaSyBkzEHM9fXRoCYSgEW-hk_lN7sL_nSLDfU",
                authDomain: "cst-institute-app.firebaseapp.com",
                projectId: "cst-institute-app",
                storageBucket: "cst-institute-app.firebasestorage.app",
                messagingSenderId: "485166460200",
                appId: "1:485166460200:web:4eae20e2010ab92baeb41d"
            };
            if (typeof firebase !== 'undefined' && !firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                const messaging = firebase.messaging();
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/firebase-messaging-sw.js').then(reg => {
                        messaging.getToken({ vapidKey: 'BBOMxvKvbEs_t9ykKBa2zIewzCzD6FCbm9rxc8a9eWl2kjjH5vyTSH6TeQMksZ_OGl5jZyQpU2wBcf-KsZN1uko', serviceWorkerRegistration: reg })
                        .then(token => { 
                            if(token) fetch(`${API_BASE_URL}/save_fcm_token`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({token}) }); 
                        });
                    });
                    messaging.onMessage(payload => alert(`${payload.notification.title}: ${payload.notification.body}`));
                }
            }
        } catch(e) { console.log('Firebase Error', e); }
    }

    // Start
    init();
</script>
</body>
</html>